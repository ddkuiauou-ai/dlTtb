<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <!-- 이 문서에서 발생하는 모든 하위 요청은 no-referrer -->
    <meta name="referrer" content="no-referrer" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>html,body{margin:0;height:100%;overflow:hidden} video{width:100%;height:100%;background:#000;object-fit:cover}</style>
  </head>
  <body>
    <!-- 쿼리로 mp4 URL을 전달받아 재생 -->
    <video id="v" controls playsinline preload="metadata" muted loop></video>
    <script>
      const params = new URLSearchParams(location.search);
      const src = params.get('src');
      const autoplay = params.get('autoplay') === '1';
      const el = document.getElementById('v');
      if (autoplay) {
        el.setAttribute('autoplay', '');
      } else {
        el.removeAttribute('autoplay');
      }
      if (src) {
        el.src = src;
      }
      if (autoplay) {
        const tryPlay = () => {
          el.play().catch(() => {});
        };
        if (el.readyState >= 2) {
          tryPlay();
        } else {
          el.addEventListener('canplay', tryPlay, { once: true });
        }
      } else {
        el.pause();
      }

      const handleMessage = (event) => {
        if (!event || typeof event.data !== 'object' || event.data === null) return;
        if (event.origin && event.origin !== window.location.origin) return;
        const { type } = event.data;
        if (type === 'pause') {
          try {
            el.pause();
          } catch {
            /* ignore */
          }
        } else if (type === 'play') {
          try {
            const maybePromise = el.play();
            if (maybePromise && typeof maybePromise.catch === 'function') {
              maybePromise.catch(() => {});
            }
          } catch {
            /* ignore */
          }
        }
      };

      window.addEventListener('message', handleMessage);
    </script>
  </body>
</html>
